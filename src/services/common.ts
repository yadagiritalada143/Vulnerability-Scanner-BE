import UserModel from '../model/userModel';
import user from '../types/user';


interface FetchUserResponse {
    success: boolean;
    user?: user;
}

interface UpdateProfileResponse {
    success: boolean;
}

const getUserDetails = (email: string): Promise<FetchUserResponse> => {
    return new Promise((resolve, reject) => {
        UserModel.findOne({ where: { email } })
            .then(user => {
                if (!user) {
                    resolve({ success: false });
                } else {
                    resolve({
                        success: true,
                        user: {
                            firstName: user.lastName,
                            lastName: user.lastName,
                            userName: user.userName,
                            password: user.password,
                            email: user.email,
                            mobileNumber: user.mobileNumber,
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Error in fetching details:', error);
                reject({ success: false });
            });
    });
}

const updateProfile = (userDetailsToUpdate: user): Promise<UpdateProfileResponse> => {
    const { firstName, lastName, userName, password, mobileNumber, email } = userDetailsToUpdate;
    return new Promise((resolve, reject) => {
        UserModel
            .update({ firstName, lastName, userName, password, mobileNumber }, { where: { email: email } })
            .then((responseAfterUpdateProfile) => {
                resolve({
                    success: true
                });
            })
            .catch(error => {
                console.error('Error in updating Profile:', error);
                reject({ success: false });
            });
    });
}


const commonService = { getUserDetails, updateProfile };
export default commonService;